# SparrowDB GUI界面使用说明

## 概述

SparrowDB GUI是一个基于Java Swing的图形用户界面，为SparrowDB迷你数据库提供友好的操作界面。该界面包含SQL输入、结果显示、Token分析和AST显示等功能。

## 界面布局

### 1. 顶部区域 - SQL输入
- **SQL输入区域**：用于输入SQL语句
- **执行按钮**：执行输入的SQL语句
- **清空按钮**：清空所有显示区域
- **查看目录按钮**：显示数据库目录信息
- **状态标签**：显示当前操作状态

### 2. 底部左侧 - 执行结果
- 显示SQL执行结果
- 显示错误信息
- 显示编译状态

### 3. 底部右侧 - 分析信息
- **Token列表**：显示SQL语句的词法分析结果
- **AST结构**：显示抽象语法树和执行计划

## 功能特性

### 支持的SQL语句
- `CREATE TABLE`：创建表
- `INSERT INTO`：插入数据
- `SELECT`：查询数据
- `DELETE FROM`：删除数据

### 自动补全功能
- **SQL关键字补全**：自动补全CREATE、SELECT、INSERT、DELETE等SQL关键字
- **表名补全**：根据数据库目录自动补全表名
- **列名补全**：根据表结构自动补全列名，支持"表名.列名"格式
- **智能上下文**：根据当前SQL语句的上下文提供相关建议
- **下拉选择框**：类似Navicat的自动补全体验，显示所有可能的选项
- **多种触发方式**：
  - 输入字母、数字或下划线时自动触发
  - 按Tab键手动触发
  - 按Ctrl+Space手动触发
- **鼠标和键盘导航**：
  - 使用上下箭头键在建议列表中导航
  - 鼠标点击选择建议
  - Enter或Tab键确认选择
  - Escape键取消补全
- **智能定位**：下拉选择框始终显示在SQL输入区域下方，不会遮挡用户输入的内容
- **动态跟随**：下拉框位置会随着用户输入和光标移动而动态调整

### 语法高亮功能
- **SQL关键字高亮**：SELECT、FROM、WHERE等关键字显示为蓝色粗体
- **字符串高亮**：单引号和双引号包围的字符串显示为绿色
- **数字高亮**：数字字面量显示为红色
- **注释高亮**：--单行注释和/*多行注释*/显示为灰色斜体
- **运算符高亮**：=、<、>、AND、OR等运算符显示为紫色
- **函数高亮**：COUNT、SUM、AVG等函数名显示为青色
- **实时更新**：输入时自动应用语法高亮，无需手动刷新
- **专业外观**：类似专业SQL编辑器的语法高亮效果
- **性能优化**：延迟更新机制，避免频繁重绘导致的卡顿
- **可控制开关**：可以通过界面上的"语法高亮"复选框启用/禁用

### 特殊命令
- `catalog`：查看数据库目录信息
- `clear`：清空数据库目录
- `exit`：退出程序

### 快捷键
- `Ctrl + Enter`：执行SQL语句
- `Tab`：触发自动补全
- `Ctrl + Space`：手动触发自动补全

## 运行方法

### 方法一：使用脚本运行（推荐）

#### Windows系统
```bash
# 双击运行或在命令行执行
run_gui.bat
```

#### Linux/Mac系统
```bash
# 在终端执行
./run_gui.sh
```

### 方法二：手动编译运行

#### 1. 编译Java文件
```bash
# 进入项目目录
cd SqlTranslater/DB

# 编译GUI相关文件
javac -cp "target/classes" -d target/classes src/main/java/com/sqlcompiler/DatabaseGUI.java src/main/java/com/sqlcompiler/EnhancedSQLCompiler.java
```

#### 2. 运行GUI程序
```bash
java -cp "target/classes" com.sqlcompiler.DatabaseGUI
```

## 使用示例

### 1. 创建表
```sql
CREATE TABLE students (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT
);
```

### 2. 插入数据
```sql
INSERT INTO students VALUES (1, '张三', 20);
INSERT INTO students VALUES (2, '李四', 21);
```

### 3. 查询数据
```sql
SELECT * FROM students;
SELECT name, age FROM students WHERE age > 20;
```

### 4. 删除数据
```sql
DELETE FROM students WHERE id = 1;
```

## 自动补全使用示例

### 1. SQL关键字补全
在SQL输入区域输入 `f` 然后按Tab键，会弹出下拉选择框显示所有以'f'开头的选项：
- `FALSE`
- `FROM`
- `FOREIGN`
- `FLOAT`
- 等等...

### 2. 表名补全
输入 `SELECT * FROM stu` 然后按Tab键，会显示所有以'stu'开头的表名选项

### 3. 列名补全
输入 `SELECT na` 然后按Tab键，会显示所有以'na'开头的列名选项

### 4. 带表前缀的列名补全
输入 `SELECT students.na` 然后按Tab键，会显示students表中所有以'na'开头的列名

### 5. 手动触发补全
在任何时候按 `Ctrl + Space` 可以手动触发自动补全功能

### 6. 选择和使用
- **键盘导航**：使用上下箭头键在建议列表中导航
- **鼠标选择**：直接点击想要的选项
- **确认选择**：按Enter或Tab键确认当前选中的选项
- **取消补全**：按Escape键关闭下拉选择框
- **自动隐藏**：点击其他地方或失去焦点时自动隐藏

### 7. 智能定位特性
- **始终在下方**：下拉选择框永远显示在SQL输入区域的下方
- **不遮挡内容**：无论用户输入多少内容，下拉框都不会遮挡SQL语句
- **动态调整**：当用户继续输入或移动光标时，下拉框位置会自动更新
- **边界检测**：如果下方空间不够，会自动显示在上方

## 语法高亮使用示例

### 1. 关键字高亮
输入以下SQL语句，您会看到不同颜色的语法高亮：
```sql
SELECT * FROM users WHERE age > 18;
```
- `SELECT`、`FROM`、`WHERE` 显示为**蓝色粗体**
- `18` 显示为**红色**
- `>` 显示为**紫色**

### 2. 字符串和注释高亮
```sql
-- 这是单行注释
SELECT name FROM users WHERE name = 'John';
/* 这是多行注释
   可以跨越多行 */
```
- 注释显示为**灰色斜体**
- `'John'` 显示为**绿色**

### 3. 函数高亮
```sql
SELECT COUNT(*), AVG(age), MAX(salary) FROM employees;
```
- `COUNT`、`AVG`、`MAX` 显示为**青色**

### 4. 复杂查询高亮
```sql
SELECT u.name, COUNT(o.id) as order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE u.status = 'active' AND o.created_date > '2023-01-01'
GROUP BY u.id
HAVING COUNT(o.id) > 5
ORDER BY order_count DESC;
```

### 5. 语法高亮特性
- **实时更新**：输入时立即看到语法高亮效果
- **智能识别**：自动识别SQL关键字、函数、运算符等
- **多行支持**：支持多行SQL语句的语法高亮
- **注释支持**：支持单行注释(--)和多行注释(/* */)
- **性能优化**：使用延迟更新机制，避免输入时的卡顿
- **可控制开关**：如果遇到性能问题，可以取消勾选"语法高亮"复选框

### 6. 性能优化说明
- **延迟更新**：语法高亮会在用户停止输入300毫秒后执行，避免频繁重绘
- **长度限制**：超过10000字符的文档不会进行语法高亮，避免性能问题
- **开关控制**：如果遇到卡顿问题，可以禁用语法高亮功能
- **后台处理**：语法高亮在后台线程中执行，不会阻塞用户输入

## 界面说明

### 状态指示
- **绿色**：操作成功
- **红色**：操作失败或错误
- **蓝色**：正在处理
- **橙色**：警告信息

### 显示区域
- **执行结果**：显示SQL执行的结果或错误信息
- **Token列表**：显示词法分析器生成的Token序列
- **AST结构**：显示抽象语法树和执行计划的详细信息

## 注意事项

1. **数据库引擎状态**：当前数据库引擎功能尚未完全实现，主要展示SQL编译和分析功能
2. **文件路径**：确保在正确的项目目录下运行程序
3. **Java版本**：需要Java 8或更高版本
4. **依赖关系**：确保所有依赖的类文件都已编译

## 故障排除

### 编译错误
- 检查Java版本是否支持
- 确保所有依赖类文件存在
- 检查文件路径是否正确

### 运行时错误
- 检查数据库目录是否存在
- 确保有足够的文件权限
- 查看控制台输出的错误信息

### 界面问题
- 如果界面显示异常，尝试调整窗口大小
- 检查系统是否支持Java Swing

## 技术架构

### 主要类文件
- `DatabaseGUI.java`：主界面类
- `EnhancedSQLCompiler.java`：增强版SQL编译器
- `SQLCompiler.java`：原始SQL编译器
- `DatabaseEngine.java`：数据库引擎

### 界面组件
- 使用Java Swing构建
- 采用BorderLayout布局
- 支持滚动条和文本换行

## 扩展功能

该GUI界面设计为可扩展的架构，已实现和未来可以添加的功能：

### 已实现功能
- ✅ **自动补全**：SQL关键字、表名、列名智能补全
- ✅ **语法高亮**：SQL语句的实时语法高亮显示
- ✅ **语法分析**：Token分析和AST结构显示
- ✅ **执行结果展示**：SQL执行结果和错误信息显示

### 未来可扩展功能
- 查询历史
- 数据可视化
- 多数据库连接
- 代码折叠
- 多标签页支持
- 自定义主题
- 错误提示高亮

## 联系信息

如有问题或建议，请查看项目文档或联系开发团队。
