# SparrowDB
方宇航，侯俊译，石墨潇的实训项目
# 第一阶段（文档与接口设计）交付清单

## 项目概述
基于《大型平台软件设计实习》实训要求，构建数据库系统项目的第一阶段交付物。

## 一、SQL编译器设计文档

### 1.1 词法分析设计
- [ ] **词法规则定义文档**
  - 关键字定义（SELECT、FROM、WHERE、CREATE、TABLE、INSERT、INTO、VALUES、DELETE等）
  - 标识符规则（表名、列名命名规范）
  - 常量规则（数字、字符串格式）
  - 运算符定义（比较、逻辑、算术运算符）
  - 分隔符定义（括号、逗号、分号等）

- [ ] **Token输出格式规范**
  - 种别码（Token Type）定义：KEYWORD、IDENTIFIER、CONST、OPERATOR、DELIMITER
  - 输出格式：[种别码，词素值，行号，列号]
  - 错误处理格式：[错误类型，位置，原因说明]

- [ ] **词法分析器接口设计**
  - 输入接口：SQL文件或标准输入
  - 输出接口：Token流
  - 错误处理接口：错误提示及位置信息

### 1.2 语法分析设计
- [ ] **SQL子集文法定义**
  - CREATE TABLE语句文法
  - INSERT语句文法
  - SELECT语句文法（含WHERE条件）
  - DELETE语句文法

- [ ] **抽象语法树（AST）结构设计**
  - AST节点类型定义
  - 树结构表示方法
  - 输出格式规范

- [ ] **语法分析器接口设计**
  - 输入：Token流
  - 输出：AST或错误信息
  - 错误处理：出错位置及期望符号提示

### 1.3 语义分析设计
- [ ] **模式目录（Catalog）设计**
  - 表结构存储格式
  - 列信息管理（列名、类型、约束）
  - Catalog维护机制

- [ ] **语义检查规则定义**
  - 表/列存在性检查规则
  - 类型一致性检查规则
  - 列数/列序检查规则

- [ ] **语义分析器接口设计**
  - 输入：AST
  - 输出：语义检查结果或错误信息
  - 错误格式：[错误类型，位置，原因说明]

### 1.4 执行计划生成设计
- [ ] **执行算子定义**
  - CreateTable算子
  - Insert算子
  - SeqScan算子
  - Filter算子
  - Project算子

- [ ] **执行计划表示格式**
  - 树形结构格式
  - JSON格式选项
  - S表达式格式选项

- [ ] **执行计划生成器接口设计**
  - 输入：语义检查通过的AST
  - 输出：逻辑执行计划
  - 错误处理：不支持语法的错误提示

## 二、存储系统设计文档

### 2.1 页式存储模型设计
- [ ] **页结构设计文档**
  - 页大小规范（4KB）
  - 页编号方案
  - 页内数据组织格式
  - 页头信息设计

- [ ] **存储接口设计**
  - `read_page(page_id)` 接口规范
  - `write_page(page_id, data)` 接口规范
  - 页分配接口 `allocate_page()`
  - 页释放接口 `deallocate_page(page_id)`

- [ ] **数据表到页映射设计**
  - 表数据在页中的存储方式
  - 记录（Row）在页中的布局
  - 页间关系管理

### 2.2 缓存管理设计
- [ ] **缓存机制设计文档**
  - 缓存结构设计
  - 缓存大小配置
  - 缓存命中判断逻辑

- [ ] **替换策略设计**
  - LRU（最近最少使用）算法实现
  - FIFO（先进先出）算法实现
  - 替换策略选择机制

- [ ] **缓存接口设计**
  - `get_page(page_id)` 接口规范
  - `flush_page(page_id)` 接口规范
  - 缓存统计接口
  - 替换日志接口

### 2.3 存储与数据库集成接口
- [ ] **统一存储访问接口设计**
  - 页级读写接口标准
  - 缓存统计接口标准
  - 日志输出接口标准

- [ ] **与SQL编译器对接设计**
  - 执行计划到存储操作的映射
  - 数据类型在存储层的表示
  - 错误处理机制

## 三、数据库系统架构设计

### 3.1 系统整体架构
- [ ] **系统架构设计文档**
  - 执行引擎模块设计
  - 存储引擎模块设计
  - 系统目录模块设计
  - 模块间接口定义

- [ ] **数据流设计**
  - SQL语句处理流程
  - 数据读写流程
  - 错误处理流程

### 3.2 系统目录设计
- [ ] **元数据管理设计**
  - 表结构元数据格式
  - 系统目录表设计（pg_catalog风格）
  - 元数据持久化方案

- [ ] **目录操作接口设计**
  - 目录初始化接口
  - 表结构查询接口
  - 表结构更新接口

### 3.3 用户交互接口设计
- [ ] **命令行界面（CLI）设计**
  - 命令输入格式
  - 结果输出格式
  - 错误信息显示格式

- [ ] **API接口设计**（可选）
  - RESTful API规范
  - 请求/响应格式
  - 错误码定义

## 四、测试计划与用例设计

### 4.1 测试用例设计
- [ ] **SQL编译器测试用例**
  - 正确语句测试：
    ```sql
    CREATE TABLE student(id INT, name VARCHAR, age INT);
    INSERT INTO student(id,name,age) VALUES (1,'Alice',20);
    SELECT id,name FROM student WHERE age > 18;
    DELETE FROM student WHERE id = 1;
    ```
  - 错误语句测试：
    - 缺分号测试
    - 列名拼写错误测试
    - 类型不匹配测试
    - 值个数不一致测试
    - 未闭合字符串测试

- [ ] **存储系统测试用例**
  - 页分配与释放测试
  - 缓存命中率测试
  - 替换策略效果测试
  - 数据持久化测试

- [ ] **集成测试用例**
  - 端到端功能测试
  - 数据一致性测试
  - 系统重启后数据恢复测试

### 4.2 测试环境规范
- [ ] **测试环境配置**
  - 开发环境要求
  - 测试数据准备
  - 测试工具选择

- [ ] **测试结果验证标准**
  - 功能正确性标准
  - 性能指标标准
  - 错误处理标准

## 五、项目管理文档

### 5.1 开发计划
- [ ] **里程碑规划**
  - 第一阶段：文档与接口设计
  - 第二阶段：核心功能实现
  - 第三阶段：集成测试与优化

- [ ] **任务分解与时间规划**
  - SQL编译器开发计划
  - 存储系统开发计划
  - 集成测试计划

### 5.2 技术规范
- [ ] **编码规范文档**
  - 代码风格标准
  - 命名规范
  - 注释规范

- [ ] **版本控制规范**
  - Git使用规范
  - 分支管理策略
  - 提交信息格式

## 六、文档交付清单

### 6.1 设计文档
- [ ] SQL编译器详细设计文档
- [ ] 存储系统详细设计文档
- [ ] 数据库系统架构设计文档
- [ ] 接口规范文档

### 6.2 规范文档
- [ ] 词法分析规范
- [ ] 语法分析规范
- [ ] 语义分析规范
- [ ] 存储格式规范

### 6.3 测试文档
- [ ] 测试计划文档
- [ ] 测试用例文档
- [ ] 测试环境配置文档

### 6.4 项目管理文档
- [ ] 项目计划文档
- [ ] 技术规范文档
- [ ] 风险评估文档

---

## 交付验收标准

1. **完整性**：所有设计文档齐全，接口定义清晰
2. **一致性**：各模块间接口设计协调一致
3. **可实现性**：设计方案技术可行，复杂度适中
4. **可测试性**：测试用例覆盖全面，验证标准明确
5. **规范性**：文档格式规范，技术描述准确

## 注意事项

1. 所有接口设计需要考虑错误处理和异常情况
2. 文档应该包含足够的技术细节，便于后续实现
3. 测试用例应该覆盖正常流程和异常流程
4. 设计应该考虑系统的可扩展性和可维护性
5. 接口设计应该遵循模块化和低耦合原则
